function getQueryStringRegExp(e){var t=new RegExp("(^|\\?|&)"+e+"=([^&]*)(\\s|&|$)","i");return t.test(location.href)?"utm_kw"==e?decodeURI(RegExp.$2.replace(/\+/g," ")):unescape(RegExp.$2.replace(/\+/g," ")):"non"}function hostfilter(){for(var e=document.location.hostname,t=["ve.cn","ve11.cn","cnvew.com"],r=["test","release","test.m","mob","rc","rc.m","local"],a=0,i=0;i<t.length;i++){var n=t[i];if(-1!=e.indexOf(n))for(var p=e.slice(0,-(n.length+1)),c=0;c<r.length;c++)if(p==r[c]){a++;break}}return a>0?!1:!0}function getReferrer(){var e="";try{e=window.top.document.referrer}catch(t){if(window.parent)try{e=window.parent.document.referrer}catch(r){e=""}}return""===e&&(e=document.referrer),e}var _paq=_paq||[],NewAtt,NewURL,referer=getReferrer().substr(0,255),GetSource=getQueryStringRegExp("utm_source"),GetCampaign=getQueryStringRegExp("utm_campaign"),GetTerm=getQueryStringRegExp("utm_term"),GetContent=getQueryStringRegExp("utm_content"),GetKeyword=getQueryStringRegExp("utm_kw"),GetMedium=getQueryStringRegExp("utm_medium"),NewURL=document.URL,_smt_VisitorId;-1!=NewURL.indexOf("utm_source=")&&(NewURL=NewURL.replace("&utm_medium="+GetMedium,""),NewURL=NewURL.replace("&utm_campaign="+GetCampaign,""),NewURL=NewURL.replace("&utm_term="+GetTerm,""),NewURL=NewURL.replace("&utm_content="+GetContent,""),NewURL=NewURL.replace("&utm_kw="+GetKeyword,""),NewURL=NewURL.replace("utm_medium="+GetMedium+"&",""),NewURL=NewURL.replace("utm_campaign="+GetCampaign+"&",""),NewURL=NewURL.replace("utm_term="+GetTerm+"&",""),NewURL=NewURL.replace("utm_content="+GetContent+"&",""),NewAtt="pk_campaign="+GetSource+"-"+GetCampaign+"-"+GetTerm+"&pk_kwd="+GetContent+"-"+GetMedium,NewURL=NewURL.replace("utm_source="+GetSource,NewAtt)),""!=user_id&&_paq.push(["setCustomVariable",1,"userid",user_id,"visit"]),""!=product_id&&_paq.push(["setCustomVariable",3,"product_id",product_id,"page"]),""!=orderid&&(_paq.push(["setCustomVariable",2,"orderid",orderid,"visit"]),_paq.push(["setCustomVariable",5,"orderid",orderid,"page"])),"non"!=GetKeyword&&_paq.push(["setCustomVariable",4,"utm_kw",GetKeyword,"visit"]),_paq.push(["setCustomVariable",10,"referer",referer,"page"]),_paq.push(["setDocumentTitle",document.domain+"/"+document.title]),_paq.push(["setCustomUrl",NewURL]);try{_paq.push(["trackPageView",NewURL])}catch(error){}_paq.push([function(){_smt_VisitorId=this.getVisitorId()}]),function(){if(hostfilter())var e=("https:"==document.location.protocol?"https":"http")+"://stat.ve.cn/";else var e=("https:"==document.location.protocol?"https":"http")+"://test.piwik.ve.cn/";_paq.push(["setTrackerUrl",e+"piwik.php"]),_paq.push(["setSiteId","1"]);var t=document,r=t.createElement("script"),a=t.getElementsByTagName("script")[0];r.type="text/javascript",r.defer=!0,r.async=!0,r.src=e+"piwik.js",a.parentNode.insertBefore(r,a)}();var veTracker={track:function(e,t,r){for(var a=11;20>=a;a++)_paq.push(["deleteCustomVariable",a,"page"]);if(this.isArray(t)){for(var i,n=!1,a=0,p=t.length;p>a;a++)i=t[a],"visit"===i.scope&&(n=!0),_paq.push(["setCustomVariable",i.index||"",i.key||"",i.value||"",i.scope||""]);if(n)try{_paq.push(["trackPageView",NewURL])}catch(c){}}this.send(e,r)},send:function(e,t){var r=void 0==t?"interaction":t,a=$(e),i=a.data(r)||a.attr("data-"+r);if(void 0!=i&&(i=i.split("|"),particularTracker.track(a,i),_paq.push(["setCustomVariable",6,"page",i[0],"page"]),_paq.push(["setCustomVariable",7,"module",i[1],"page"]),_paq.push(["setCustomVariable",8,"paging_number",i[2],"page"]),_paq.push(["setCustomVariable",9,"position_1",i[3],"page"]),_paq.push(["setCustomVariable",10,"referer",window.location.href,"page"])),"interaction"==r)try{_paq.push(["trackContentInteraction",a[0].tagName,"click","",""])}catch(n){}},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},particularTracker={track:function(e,t){for(var r in particularTracker)"track"!=r&&"function"==typeof particularTracker[r]&&particularTracker[r](e,t)},paying:function(e,t){if(t[0].indexOf("paying")>=0){var r,a=0;if(r=e.data("bank")||e.attr("data-bank"),void 0!==r&&""!==r)_paq.push(["setCustomVariable",15,"bank",r,"page"]);else if("paymentplatform"===t[1]){var a=parseInt(t[3]);1===a&&(r="alipay"),2===a&&(r="tenpay"),_paq.push(["setCustomVariable",15,"bank",r,"page"])}}},cart:function(e,t){if("cart"===t[0]){var r,a="",i=0,n=0;if(t[1].indexOf("mycart")>=0&&"mycartproductdel"==t[1]){r=e.parent().parent().parent(),a=r.children(".product_box").find("a").attr("href");var p=new RegExp("goods-[0-9]+","g");null!=a.match(p)&&(a=a.match(p).toString(),p=new RegExp("[0-9]+","g"),a=a.match(p).toString()),i=r.children(".number_box").find(".item-buy-quantity-input").val(),n=$.trim(r.children(".price_box").text()).replace(/¥|￥/,"")}"improvisingaddcart"==t[1]&&(a=e.data("id")||e.attr("data-id"),r=e.parent(),i=1,n=$.trim(r.find(".price span").text()).replace(/¥|￥/,"")),_paq.push(["setCustomVariable",12,"productid",a,"page"]),_paq.push(["setCustomVariable",13,"productcount",i,"page"]),_paq.push(["setCustomVariable",14,"productprice",n,"page"])}}};$(document).ready(function(){var e=$("[data-interaction]");"function"==typeof e.on?e.on("click",function(){veTracker.track($(this),{},"interaction")}):e.click(function(){veTracker.track($(this),{},"interaction")})});